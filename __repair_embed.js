const fs = require('fs');
const path = 'd:/AlgoCard';
const dataPath = `${path}/data/algorithms.json`;
const htmlPath = `${path}/index.html`;
const dataRaw = fs.readFileSync(dataPath, 'utf8');
const data = JSON.parse(dataRaw);
const pretty = JSON.stringify(data, null, 2);
let html = fs.readFileSync(htmlPath, 'utf8');
const startTag = '<script id="fallback-data" type="application/json">';
const endTag = '</script>';
const start = html.indexOf(startTag);
if (start === -1) throw new Error('fallback-data tag not found');
const end = html.indexOf(endTag, start + startTag.length);
if (end === -1) throw new Error('fallback-data end tag not found');
html = html.slice(0, start + startTag.length) + '\n' + pretty + '\n' + html.slice(end);
fs.writeFileSync(htmlPath, html, 'utf8');
const verify = html.slice(html.indexOf(startTag) + startTag.length, html.indexOf(endTag, html.indexOf(startTag) + startTag.length)).trim();
const parsed = JSON.parse(verify);
console.log('embedded repaired', Array.isArray(parsed) ? parsed.length : 0);
